name: Create Cypress report

on:
    push:
        branches:
        - 'master'
    workflow_dispatch:

jobs:
    cypress-e2e-chrome81:
        name: Run on Chrome
        runs-on: ubuntu-latest
        container: cypress/browsers:latest

        steps:
            - uses: actions/checkout@v2
            - name: Install a project with a clean slate
              run: |
                npm ci
                $(npm bin)/cypress cache path
                $(npm bin)/cypress cache list
                $(npm bin)/cypress verify


            - name: Cypress run
              uses: cypress-io/github-action@v2
              with:
                start: npm start
                wait-on: 'http://localhost:8888'
                
            - name: Run Cypress tests
              run: npm run cypress:run:chrome
              continue-on-error: true

            - name: Copy test execution videos
              run: |
                mkdir public
                cp -r cypress/videos public/videos
            
            - name: Merge test results into one
              run: npm run report:merge

            - name: Generate HTML report
              run: npm run report:generate

            - name: Deploy report page
              uses: peaceiris/actions-gh-pages@v3
              with:
                github_token: ${{ secrets.GITHUB_TOKEN }}
                publish_dir: ./public
                user_name: 'github-actions[bot]'
                user_email: 'github-actions[bot]@users.noreply.github.com'












 - name: Checkout
        uses: actions/checkout@v1
      - name: Cypress run
        uses: cypress-io/github-action@v2
        with:
          start: npm start
          # quote the url to be safe against YML parsing surprises
          wait-on: 'http://localhost:8080'